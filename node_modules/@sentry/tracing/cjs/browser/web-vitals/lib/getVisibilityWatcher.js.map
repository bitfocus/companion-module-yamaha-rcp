{"version":3,"file":"getVisibilityWatcher.js","sources":["../../../../../../src/browser/web-vitals/lib/getVisibilityWatcher.ts"],"sourcesContent":["/*\n * Copyright 2020 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { WINDOW } from '../../types';\nimport { onHidden } from './onHidden';\n\nlet firstHiddenTime = -1;\n\nconst initHiddenTime = (): number => {\n  // If the document is hidden and not prerendering, assume it was always\n  // hidden and the page was loaded in the background.\n  return WINDOW.document.visibilityState === 'hidden' && !WINDOW.document.prerendering ? 0 : Infinity;\n};\n\nconst trackChanges = (): void => {\n  // Update the time if/when the document becomes hidden.\n  onHidden(({ timeStamp }) => {\n    firstHiddenTime = timeStamp;\n  }, true);\n};\n\nexport const getVisibilityWatcher = (): {\n  readonly firstHiddenTime: number;\n} => {\n  if (firstHiddenTime < 0) {\n    // If the document is hidden when this code runs, assume it was hidden\n    // since navigation start. This isn't a perfect heuristic, but it's the\n    // best we can do until an API is available to support querying past\n    // visibilityState.\n    firstHiddenTime = initHiddenTime();\n    trackChanges();\n  }\n  return {\n    get firstHiddenTime() {\n      return firstHiddenTime;\n    },\n  };\n};\n"],"names":["WINDOW","onHidden"],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA;AACA,IAAA,eAAA,GAAA,CAAA,CAAA,CAAA;AACA;AACA,MAAA,cAAA,GAAA,MAAA;AACA;AACA;AACA,EAAA,OAAAA,YAAA,CAAA,QAAA,CAAA,eAAA,KAAA,QAAA,IAAA,CAAAA,YAAA,CAAA,QAAA,CAAA,YAAA,GAAA,CAAA,GAAA,QAAA,CAAA;AACA,CAAA,CAAA;AACA;AACA,MAAA,YAAA,GAAA,MAAA;AACA;AACA,EAAAC,iBAAA,CAAA,CAAA,EAAA,SAAA,EAAA,KAAA;AACA,IAAA,eAAA,GAAA,SAAA,CAAA;AACA,GAAA,EAAA,IAAA,CAAA,CAAA;AACA,CAAA,CAAA;AACA;AACA,MAAA,oBAAA,GAAA;AACA;AACA,KAAA;AACA,EAAA,IAAA,eAAA,GAAA,CAAA,EAAA;AACA;AACA;AACA;AACA;AACA,IAAA,eAAA,GAAA,cAAA,EAAA,CAAA;AACA,IAAA,YAAA,EAAA,CAAA;AACA,GAAA;AACA,EAAA,OAAA;AACA,IAAA,IAAA,eAAA,GAAA;AACA,MAAA,OAAA,eAAA,CAAA;AACA,KAAA;AACA,GAAA,CAAA;AACA;;;;"}